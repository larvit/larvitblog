<%= _.render('inc/head', obj) %>
<%= _.render('inc/pageTop', obj) %>
<script src="//tinymce.cachefly.net/4.2/tinymce.min.js"></script>
<script>tinymce.init({
	'selector': 'textarea',
	'toolbar': 'undo redo | bold italic underline strikethrough | bullist numlist | subscript superscript | link unlink | removeformat code',
	'menubar': false,
	'plugins': 'link image code',
	'valid_elements': 'ul,li,ol,br,p,strong,a[href|target],em,span,sup,sub'
});</script>
<link rel="stylesheet" type="text/css" href="vendor/css/jquery.tagit.css" />
<script src="vendor/js/tag-it.min.js"></script>
<script>$(function(){
	$('.tagit').tagit({
		'allowSpaces': true
	});
});</script>
<form method="post" enctype="multipart/form-data">

	<%= _.render('inc/adminBlogpostEditControls', obj) %>

	<fieldset>
		<legend>Identity</legend>

		<div class="row">
			<div class="three columns">
				<label for="id">Id</label>
				<input type="text" value="<%= global.urlParsed.query.id %>" disabled="disabled" />
			</div>

			<div class="three columns">
				<label for="created">Created</label>
				<input type="text" value="<% if (global.formFields.created) print(_.moment(global.formFields.created).format('YYYY-MM-DD HH:mm:ss')) %>" disabled="disabled" />
			</div>

			<div class="three columns">
				<label for="published">Published</label>
				<input type="text" name="published" value="<%
					if (global.formFields.published)
						print(_.moment(global.formFields.published).format('YYYY-MM-DD HH:mm:ss'));
					else if ( ! global.urlParsed.query.id)
						print(_.moment().format('YYYY-MM-DD HH:mm:ss'));
				%>" placeholder="YYYY-MM-DD hh:mm:ss" />
			</div>
		</div>
	</fieldset>

	<% if ( ! global.urlParsed.query.langs) global.urlParsed.query.langs = 'en'; %>

	<% _.each(global.urlParsed.query.langs.split(','), function(lang) { %>
	<fieldset>
		<legend>Entry content, language: <%= lang %></legend>

		<div class="row">
			<div class="six columns">
				<label for="header.<%= lang %>">Header</label>
				<input type="text" name="header.<%= lang %>" value="<% if (global.formFields['header.' + lang]) print(global.formFields['header.' + lang]) %>" />
			</div>

			<div class="six columns">
				<label for="slug.<%= lang %>">Slug</label>
				<input type="text" name="slug.<%= lang %>" value="<% if (global.formFields['slug.' + lang]) print(global.formFields['slug.' + lang]) %>" />
			</div>
		</div>

		<div class="row">
			<label for="tags.<%= lang %>">Tags</label>
			<input type="text" name="tags.<%= lang %>" value="<% if (global.formFields['tags.' + lang]) print(global.formFields['tags.' + lang]) %>" class="tagit" autocomplete="off" />
		</div>

		<div class="row">
			<label for="body.<%= lang %>">Entry summary</label>
			<textarea class="u-full-width" name="summary.<%= lang %>" rows="5"><% if (global.formFields['summary.' + lang]) print(global.formFields['summary.' + lang]) %></textarea>
		</div>

		<div class="row">
			<label for="body.<%= lang %>">Entry content</label>
			<textarea class="u-full-width" name="body.<%= lang %>" rows="20"><% if (global.formFields['body.' + lang]) print(global.formFields['body.' + lang]) %></textarea>
		</div>

		<div class="row">
			<% var i = 0; %>
			<% while (i < 5) { %>
				<% i ++; %>

				<div class="two columns">
					<label for="image<%= i %>">Img <%= i %></label>
					<input type="file" name="image<%= i %>" />
				</div>
			<% } %>
		</div>

		<% if (global.urlParsed.query.id) { %>
		<div class="row">
			<% var i = 0; %>
			<% while (i < 5) { %>
				<% i ++; %>

				<div class="two columns">
					<% _.each(dbImages, function(image) { %>
						<% if (image.slug.substring(0, 16 + global.urlParsed.query.id.toString().length + i.toString().length) === 'blog_entry' + global.urlParsed.query.id + '_image' + i) { %>
							<img src="/uploaded/images/<%= image.slug %>?width=200" alt="" style="width: 100%" />
						<% } %>
					<% }); %>
					<p style="font-size: 1px; height: 1px;">&nbsp;</p>
				</div>
			<% } %>
		</div>

		<div class="row">
			<% var i = 0; %>
			<% while (i < 5) { %>
				<% i ++; %>

				<div class="two columns">
					<% _.each(dbImages, function(image) { %>
						<% var shortSlug = 'blog_entry' + global.urlParsed.query.id + '_image' + i; %>
						<% if (image.slug.substring(0, 16 + global.urlParsed.query.id.toString().length + i.toString().length) === shortSlug) { %>
							<label for="<%= shortSlug %>">
								<input type="checkbox" name="rm_image_<%= i %>" />
								<span class="label-body">Delete</span>
							</label>
						<% } %>
					<% }); %>
					<p style="font-size: 1px; height: 1px;">&nbsp;</p>
				</div>
			<% } %>
		</div>
		<% } %>
	</fieldset>
	<% }); %>

	<%= _.render('inc/adminBlogpostEditControls', obj) %>

</form>
<%= _.render('inc/pageBottom', obj) %>
